<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ·é¢ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒ‰ãƒƒãƒˆçµµã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒ¼ã‚«ãƒ¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 flex justify-center items-center min-h-screen text-gray-800 p-8 font-sans">
    <div class="container mx-auto p-6 bg-white rounded-xl shadow-2xl max-w-6xl">
        <h1 class="text-3xl font-bold text-center mb-6">ğŸŒŠ æµ·é¢ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒ‰ãƒƒãƒˆçµµã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒ¼ã‚«ãƒ¼</h1>
        <p class="text-center text-gray-600 mb-8">ãƒ¬ãƒˆãƒ­ã‚²ãƒ¼ãƒ ã«ã´ã£ãŸã‚Šã®ã€ã‚¿ã‚¤ãƒ«åŒ–å¯èƒ½ãªæµ·é¢ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚</p>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
            <div class="flex flex-col items-center">
                <div class="rounded-lg overflow-hidden mb-4 border-4 border-gray-400" style="
                    background-image: linear-gradient(45deg, #e5e7eb 25%, transparent 25%), linear-gradient(135deg, #e5e7eb 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #e5e7eb 75%), linear-gradient(135deg, transparent 75%, #e5e7eb 75%);
                    background-size: 20px 20px;
                    background-position: 0 0, 10px 0, 10px -10px, 0 10px;
                ">
                    <canvas id="pixel-canvas" width="320" height="320" class="border-2 border-slate-700 cursor-default" style="image-rendering: pixelated;"></canvas>
                </div>

                <div class="flex items-center space-x-4 mb-4">
                    <button id="prev-frame" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full shadow-lg transition-transform transform hover:scale-105 p-3">â†</button>
                    <span id="frame-info" class="text-lg font-medium">ãƒ•ãƒ¬ãƒ¼ãƒ  1 / 1</span>
                    <button id="next-frame" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full shadow-lg transition-transform transform hover:scale-105 p-3">â†’</button>
                </div>

                <div class="flex flex-col items-center space-y-4 w-full px-4">
                    <button id="auto-generate" class="w-full text-white font-bold py-2 px-4 rounded-full shadow-lg transition-transform transform hover:scale-105 bg-green-500 hover:bg-green-600">è‡ªå‹•ç”Ÿæˆ</button>
                    <button id="play-animation" class="w-full text-white font-bold py-2 px-4 rounded-full shadow-lg transition-transform transform hover:scale-105 bg-blue-500 hover:bg-blue-600">ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†ç”Ÿ</button>
                    <button id="download-all-frames" class="w-full text-white font-bold py-2 px-4 rounded-full shadow-lg transition-transform transform hover:scale-105 bg-blue-500 hover:bg-blue-600">å…¨ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’PNGã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                </div>
            </div>

            <div class="flex flex-col items-center md:items-start">
                <div class="mb-6 w-full">
                    <h2 class="text-xl font-semibold mb-2">ğŸ¬ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
                    <div class="bg-gray-200 p-2 rounded-lg text-center">
                        <canvas id="preview-canvas" width="192" height="192" class="block mx-auto rounded-md border-2 border-gray-400" style="image-rendering: pixelated;"></canvas>
                    </div>
                </div>

                <div class="mb-6 w-full">
                    <h2 class="text-xl font-semibold mb-2">ğŸ–¼ï¸ ãƒ•ãƒ¬ãƒ¼ãƒ ã‚®ãƒ£ãƒ©ãƒªãƒ¼ (ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰)</h2>
                    <div id="frame-gallery" class="flex flex-wrap gap-2 justify-center md:justify-start bg-gray-200 p-2 rounded-lg">
                        </div>
                </div>
            </div>
        </div>
    </div>

    <div id="message-box" class="hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-10 bg-white p-6 rounded-xl shadow-2xl">
        <div id="message-text" class="text-center text-lg mb-4"></div>
        <button id="message-close" class="text-white font-bold py-2 px-4 rounded-full shadow-lg transition-transform transform hover:scale-105 bg-blue-500 hover:bg-blue-600 block mx-auto">é–‰ã˜ã‚‹</button>
    </div>

    <div id="generate-modal" class="hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-10 bg-white p-6 rounded-xl shadow-2xl">
        <h2 class="text-xl font-semibold mb-4 text-center">ç”Ÿæˆã™ã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ æ•°ã‚’å…¥åŠ›</h2>
        <input type="number" id="frame-count-input" value="8" min="2" max="32" class="w-full p-2 border rounded-md mb-4 text-center">
        <div class="flex justify-around">
            <button id="confirm-generate" class="text-white font-bold py-2 px-4 rounded-full shadow-lg transition-transform transform hover:scale-105 bg-blue-500 hover:bg-blue-600 px-6">ç”Ÿæˆ</button>
            <button id="cancel-generate" class="text-white font-bold py-2 px-4 rounded-full shadow-lg transition-transform transform hover:scale-105 bg-red-500 hover:bg-red-600 px-6">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
    </div>

    <script>
        // JavaScript for the pixel art app

        document.addEventListener('DOMContentLoaded', () => {
            // === DOMè¦ç´  ===
            const canvas = document.getElementById('pixel-canvas');
            const ctx = canvas.getContext('2d');
            const previewCanvas = document.getElementById('preview-canvas');
            const previewCtx = previewCanvas.getContext('2d');
            const frameInfoSpan = document.getElementById('frame-info');
            const prevFrameBtn = document.getElementById('prev-frame');
            const nextFrameBtn = document.getElementById('next-frame');
            const playAnimationBtn = document.getElementById('play-animation');
            const downloadAllFramesBtn = document.getElementById('download-all-frames');
            const messageBox = document.getElementById('message-box');
            const messageText = document.getElementById('message-text');
            const messageCloseBtn = document.getElementById('message-close');
            const autoGenerateBtn = document.getElementById('auto-generate');
            const generateModal = document.getElementById('generate-modal');
            const frameCountInput = document.getElementById('frame-count-input');
            const confirmGenerateBtn = document.getElementById('confirm-generate');
            const cancelGenerateBtn = document.getElementById('cancel-generate');
            const frameGallery = document.getElementById('frame-gallery');

            // === å®šæ•°ã¨çŠ¶æ…‹å¤‰æ•° ===
            const PIXEL_SIZE = 16;
            const CANVAS_SCALE = 20;
            const FRAME_RATE = 200; // ãƒŸãƒªç§’
            const CANVAS_SIZE = PIXEL_SIZE * CANVAS_SCALE;

            // ã‚­ãƒ£ãƒ³ãƒã‚¹ã®ã‚µã‚¤ã‚ºã‚’è¨­å®š
            canvas.width = CANVAS_SIZE;
            canvas.height = CANVAS_SIZE;

            let frames = [];
            let currentFrameIndex = 0;
            let animationInterval = null;

            // è‡ªå‹•ç”Ÿæˆç”¨ã®ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ
            const autoGenColors = ['#006699', '#3399cc', '#99ccff', '#cceeff'];

            // === é–¢æ•° ===

            // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒƒã‚¯ã‚¹ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
            function showMessage(text) {
                messageText.textContent = text;
                messageBox.classList.remove('hidden');
            }

            // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒƒã‚¯ã‚¹ã‚’éè¡¨ç¤ºã«ã™ã‚‹é–¢æ•°
            function hideMessage() {
                messageBox.classList.add('hidden');
            }

            // ãƒ•ãƒ¬ãƒ¼ãƒ ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚­ãƒ£ãƒ³ãƒã‚¹ã«æç”»
            function drawFrame(frameData) {
                ctx.clearRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);
                for (let i = 0; i < PIXEL_SIZE * PIXEL_SIZE; i++) {
                    const x = (i % PIXEL_SIZE) * CANVAS_SCALE;
                    const y = Math.floor(i / PIXEL_SIZE) * CANVAS_SCALE;
                    ctx.fillStyle = frameData[i];
                    ctx.fillRect(x, y, CANVAS_SCALE, CANVAS_SCALE);
                }
            }

            // ãƒ•ãƒ¬ãƒ¼ãƒ æƒ…å ±ã‚’æ›´æ–°
            function updateFrameInfo() {
                frameInfoSpan.textContent = `ãƒ•ãƒ¬ãƒ¼ãƒ  ${currentFrameIndex + 1} / ${frames.length}`;
                drawFrame(frames[currentFrameIndex]);
                updateFrameGallery();
            }

            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®æç”» (9æšã‚¿ã‚¤ãƒ«çŠ¶ã«æç”»)
            function drawPreviewFrame(frameData) {
                const previewPixelSize = 4; // 16x16 -> 64x64
                const previewTileSize = 64; // å…ƒã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚µã‚¤ã‚º
                const tiledSize = previewTileSize * 3;
                previewCanvas.width = tiledSize;
                previewCanvas.height = tiledSize;
                previewCtx.clearRect(0, 0, tiledSize, tiledSize);

                // ã‚¢ãƒ³ãƒã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’ç„¡åŠ¹ã«ã™ã‚‹
                previewCtx.imageSmoothingEnabled = false;
                previewCtx.mozImageSmoothingEnabled = false; // Firefoxå‘ã‘

                const tempCanvas = document.createElement('canvas');
                tempCanvas.width = PIXEL_SIZE;
                tempCanvas.height = PIXEL_SIZE;
                const tempCtx = tempCanvas.getContext('2d');
                for (let i = 0; i < PIXEL_SIZE * PIXEL_SIZE; i++) {
                    const x = i % PIXEL_SIZE;
                    const y = Math.floor(i / PIXEL_SIZE);
                    tempCtx.fillStyle = frameData[i];
                    tempCtx.fillRect(x, y, 1, 1);
                }

                // 3x3 ã®ã‚¿ã‚¤ãƒ«çŠ¶ã«æç”»
                for (let row = 0; row < 3; row++) {
                    for (let col = 0; col < 3; col++) {
                        previewCtx.drawImage(tempCanvas, col * previewTileSize, row * previewTileSize, previewTileSize, previewTileSize);
                    }
                }
            }

            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†ç”Ÿ
            function playAnimation() {
                if (animationInterval) {
                    clearInterval(animationInterval);
                    animationInterval = null;
                    playAnimationBtn.textContent = 'ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†ç”Ÿ';
                    return;
                }

                playAnimationBtn.textContent = 'åœæ­¢';
                let frameIndex = 0;
                animationInterval = setInterval(() => {
                    drawPreviewFrame(frames[frameIndex]);
                    frameIndex = (frameIndex + 1) % frames.length;
                }, FRAME_RATE);
            }

            // ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã‚’æ›´æ–°
            function updateFrameGallery() {
                frameGallery.innerHTML = '';
                frames.forEach((frameData, index) => {
                    const tempCanvas = document.createElement('canvas');
                    tempCanvas.width = PIXEL_SIZE;
                    tempCanvas.height = PIXEL_SIZE;
                    const tempCtx = tempCanvas.getContext('2d');
                    for (let i = 0; i < PIXEL_SIZE * PIXEL_SIZE; i++) {
                        const x = i % PIXEL_SIZE;
                        const y = Math.floor(i / PIXEL_SIZE);
                        tempCtx.fillStyle = frameData[i];
                        tempCtx.fillRect(x, y, 1, 1);
                    }
                    const dataURL = tempCanvas.toDataURL('image/png');

                    const img = new Image();
                    img.src = dataURL;
                    img.classList.add('w-16', 'h-16', 'cursor-pointer', 'border-2', 'border-transparent', 'rounded-lg', 'transition-transform', 'transform', 'hover:scale-110', 'hover:border-blue-500');
                    img.style.imageRendering = 'pixelated';
                    img.title = `ãƒ•ãƒ¬ãƒ¼ãƒ  ${index + 1} (ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰)`;

                    img.addEventListener('click', () => {
                        downloadFrame(dataURL, `sea_frame_${String(index + 1).padStart(2, '0')}.png`);
                    });

                    frameGallery.appendChild(img);
                });
            }

            // å˜ä¸€ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            function downloadFrame(dataURL, filename) {
                const link = document.createElement('a');
                link.href = dataURL;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                showMessage(`${filename} ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸï¼`);
            }

            // å…¨ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’PNGã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            function downloadAllFrames() {
                if (frames.length === 0) {
                    showMessage('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
                    return;
                }

                frames.forEach((frameData, index) => {
                    const tempCanvas = document.createElement('canvas');
                    tempCanvas.width = PIXEL_SIZE;
                    tempCanvas.height = PIXEL_SIZE;
                    const tempCtx = tempCanvas.getContext('2d');
                    for (let i = 0; i < PIXEL_SIZE * PIXEL_SIZE; i++) {
                        const x = i % PIXEL_SIZE;
                        const y = Math.floor(i / PIXEL_SIZE);
                        tempCtx.fillStyle = frameData[i];
                        tempCtx.fillRect(x, y, 1, 1);
                    }
                    const dataURL = tempCanvas.toDataURL('image/png');
                    downloadFrame(dataURL, `sea_frame_${String(index + 1).padStart(2, '0')}.png`);
                });

                showMessage('å…¨ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸï¼');
            }

            // === è‡ªå‹•ç”Ÿæˆæ©Ÿèƒ½ ===
            function autoGenerateFrames(frameCount) {
                const generatedFrames = [];
                const numColors = autoGenColors.length;

                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®æœ€åˆã¨æœ€å¾ŒãŒå®Œç’§ã«ã¤ãªãŒã‚‹ã‚ˆã†ã€å‘¨æœŸçš„ãªå¤‰æ•°ã‚’è¨­å®š
                const tStep = (2 * Math.PI) / frameCount;

                for (let f = 0; f < frameCount; f++) {
                    const newFrame = [];
                    for (let y = 0; y < PIXEL_SIZE; y++) {
                        for (let x = 0; x < PIXEL_SIZE; x++) {
                            // Xã€Yã€æ™‚é–“ã®3æ¬¡å…ƒã§æ»‘ã‚‰ã‹ãªæ³¢ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç”Ÿæˆ
                            // è¤‡æ•°ã®æ³¢ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€è¤‡é›‘ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½œã‚‹
                            const wave1 = Math.sin((x / PIXEL_SIZE) * 2 * Math.PI + (f * tStep));
                            const wave2 = Math.sin((y / PIXEL_SIZE) * 2 * Math.PI - (f * tStep));
                            const wave3 = Math.cos((x / PIXEL_SIZE) * 2 * Math.PI + (y / PIXEL_SIZE) * 2 * Math.PI + (f * tStep));

                            // çµ„ã¿åˆã‚ã›ãŸæ³¢ã®å€¤ã‚’æ­£è¦åŒ–
                            const combinedWave = (wave1 + wave2 + wave3) / 3;
                            const normalizedValue = (combinedWave + 1) / 2;

                            // æ­£è¦åŒ–ã•ã‚ŒãŸå€¤ã«åŸºã¥ã„ã¦ã€ãƒ‘ãƒ¬ãƒƒãƒˆã‹ã‚‰è‰²ã‚’é¸æŠ
                            const colorIndex = Math.floor(normalizedValue * numColors);
                            newFrame.push(autoGenColors[Math.min(colorIndex, numColors - 1)]);
                        }
                    }
                    generatedFrames.push(newFrame);
                }
                return generatedFrames;
            }

            // === ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ ===

            // ãƒ•ãƒ¬ãƒ¼ãƒ ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
            prevFrameBtn.addEventListener('click', () => {
                if (currentFrameIndex > 0) {
                    currentFrameIndex--;
                    updateFrameInfo();
                } else {
                    showMessage('æœ€åˆã®ãƒ•ãƒ¬ãƒ¼ãƒ ã§ã™ã€‚');
                }
            });

            nextFrameBtn.addEventListener('click', () => {
                if (currentFrameIndex < frames.length - 1) {
                    currentFrameIndex++;
                    updateFrameInfo();
                } else {
                    showMessage('æœ€å¾Œã®ãƒ•ãƒ¬ãƒ¼ãƒ ã§ã™ã€‚');
                }
            });

            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿ
            playAnimationBtn.addEventListener('click', playAnimation);

            // å…¨ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            downloadAllFramesBtn.addEventListener('click', downloadAllFrames);

            // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒƒã‚¯ã‚¹ã®é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³
            messageCloseBtn.addEventListener('click', hideMessage);

            // è‡ªå‹•ç”Ÿæˆãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
            autoGenerateBtn.addEventListener('click', () => {
                generateModal.classList.remove('hidden');
            });

            // è‡ªå‹•ç”Ÿæˆã®ç¢ºèª
            confirmGenerateBtn.addEventListener('click', () => {
                const frameCount = parseInt(frameCountInput.value, 10);
                if (frameCount < 2 || frameCount > 32 || isNaN(frameCount)) {
                    showMessage('2ã‹ã‚‰32ã®é–“ã®æœ‰åŠ¹ãªæ•°å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }

                generateModal.classList.add('hidden');
                frames = autoGenerateFrames(frameCount);
                currentFrameIndex = 0;
                updateFrameInfo();
                showMessage(`${frameCount}å€‹ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã—ãŸï¼`);
            });

            // è‡ªå‹•ç”Ÿæˆã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            cancelGenerateBtn.addEventListener('click', () => {
                generateModal.classList.add('hidden');
            });


            // === åˆæœŸåŒ– ===
            // æœ€åˆã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ä½œæˆã—ã¦ã€åˆæœŸçŠ¶æ…‹ã‚’è¨­å®š
            frames = autoGenerateFrames(8); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§8ãƒ•ãƒ¬ãƒ¼ãƒ ç”Ÿæˆ
            updateFrameInfo();
        });
    </script>
</body>

</html>